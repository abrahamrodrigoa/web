<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inspecci√≥n Diaria de Obra</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .section-card {
            transition: all 0.3s ease;
        }
        .section-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .photo-preview {
            width: 120px;
            height: 120px;
            object-fit: cover;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-xl p-6 mb-6">
            <div class="flex items-center gap-4">
                <div class="bg-blue-600 text-white p-4 rounded-lg">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                </div>
                <div>
                    <h1 class="text-3xl font-bold text-gray-800">Inspecci√≥n Diaria de Obra</h1>
                    <p class="text-gray-600">Complete todos los campos para generar el reporte autom√°tico</p>
                </div>
            </div>
        </div>

        <form id="inspectionForm" class="space-y-6">
            <!-- 1. INFORMACI√ìN GENERAL -->
            <div class="section-card bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                    <span class="bg-blue-600 text-white w-8 h-8 rounded-full flex items-center justify-center text-sm">1</span>
                    Informaci√≥n General
                </h2>
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Proyecto</label>
                        <input type="text" name="proyecto" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Nombre del proyecto">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Contrato No.</label>
                        <input type="text" name="contrato" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="CT-2024-XXX">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Ubicaci√≥n</label>
                        <input type="text" name="ubicacion" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Direcci√≥n de la obra">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Fecha</label>
                        <input type="date" name="fecha" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Inspector Responsable</label>
                        <input type="text" name="inspector" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Ing. Nombre Apellido">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Turno</label>
                        <select name="turno" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">Seleccionar...</option>
                            <option value="Matutino (07:00-15:00)">Matutino (07:00-15:00)</option>
                            <option value="Vespertino (15:00-23:00)">Vespertino (15:00-23:00)</option>
                            <option value="Completo (07:00-18:00)">Completo (07:00-18:00)</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- 2. CONDICIONES CLIM√ÅTICAS -->
            <div class="section-card bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                    <span class="bg-blue-600 text-white w-8 h-8 rounded-full flex items-center justify-center text-sm">2</span>
                    Condiciones Clim√°ticas
                </h2>
                <div class="grid md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Temperatura (¬∞C)</label>
                        <input type="text" name="temperatura" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="18 - 24">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Condici√≥n</label>
                        <select name="clima" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">Seleccionar...</option>
                            <option value="Despejado">‚òÄÔ∏è Despejado</option>
                            <option value="Parcialmente nublado">‚õÖ Parcialmente nublado</option>
                            <option value="Nublado">‚òÅÔ∏è Nublado</option>
                            <option value="Lluvia">üåßÔ∏è Lluvia</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Trabajable</label>
                        <select name="trabajable" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="S√ç">‚úÖ S√ç</option>
                            <option value="NO">‚ùå NO</option>
                            <option value="PARCIAL">‚ö†Ô∏è PARCIAL</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- 3. MANO DE OBRA -->
            <div class="section-card bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                    <span class="bg-blue-600 text-white w-8 h-8 rounded-full flex items-center justify-center text-sm">3</span>
                    Mano de Obra
                </h2>
                <div class="grid md:grid-cols-3 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Personal Planificado</label>
                        <input type="number" name="personal_planificado" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Personal Presente</label>
                        <input type="number" name="personal_presente" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Personal Ausente</label>
                        <input type="number" name="personal_ausente" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                </div>
            </div>

            <!-- 4. ACTIVIDADES (Din√°mico) -->
            <div class="section-card bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                    <span class="bg-blue-600 text-white w-8 h-8 rounded-full flex items-center justify-center text-sm">4</span>
                    Actividades por Zona
                </h2>
                <div id="activityContainer" class="space-y-4"></div>
                <button type="button" onclick="addActivity()" class="mt-4 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition">
                    + Agregar Actividad
                </button>
            </div>

            <!-- 5. INCIDENTES (Din√°mico) -->
            <div class="section-card bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                    <span class="bg-orange-600 text-white w-8 h-8 rounded-full flex items-center justify-center text-sm">5</span>
                    Incidentes y No Conformidades
                </h2>
                <div id="incidentContainer" class="space-y-4"></div>
                <button type="button" onclick="addIncident()" class="mt-4 bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 transition">
                    + Reportar Incidente
                </button>
            </div>

            <!-- 6. REGISTRO FOTOGR√ÅFICO -->
            <div class="section-card bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                    <span class="bg-purple-600 text-white w-8 h-8 rounded-full flex items-center justify-center text-sm">6</span>
                    Registro Fotogr√°fico
                </h2>
                <div class="mb-4">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Subir Fotos (m√°x 4)</label>
                    <input type="file" name="fotos" multiple accept="image/*" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" onchange="previewPhotos(event)">
                </div>
                <div id="photoPreview" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
            </div>

            <!-- BOT√ìN DE ENV√çO -->
            <div class="bg-gradient-to-r from-blue-600 to-indigo-600 rounded-lg shadow-xl p-6 text-center">
                <button type="submit" class="bg-white text-blue-600 font-bold px-8 py-4 rounded-lg hover:bg-gray-100 transition transform hover:scale-105 shadow-lg text-lg">
                    üöÄ Generar Reporte Autom√°tico con IA
                </button>
                <p class="text-white text-sm mt-3">El sistema generar√° el PDF y lo enviar√° autom√°ticamente</p>
            </div>
        </form>

        <!-- Loading Modal -->
        <div id="loadingModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg p-8 text-center">
                <div class="animate-spin rounded-full h-16 w-16 border-b-4 border-blue-600 mx-auto mb-4"></div>
                <p class="text-xl font-bold text-gray-800">Generando reporte...</p>
                <p class="text-gray-600">La IA est√° procesando la informaci√≥n</p>
            </div>
        </div>
    </div>

    <script>
        // Configuraci√≥n del webhook de n8n
        const WEBHOOK_URL = 'TU_URL_WEBHOOK_N8N_AQUI';

        let activityCount = 0;
        let incidentCount = 0;

        // Agregar actividad
        function addActivity() {
            activityCount++;
            const container = document.getElementById('activityContainer');
            const activityDiv = document.createElement('div');
            activityDiv.className = 'border-2 border-blue-200 rounded-lg p-4 bg-blue-50';
            activityDiv.innerHTML = `
                <div class="flex justify-between items-center mb-3">
                    <h3 class="font-bold text-gray-800">Actividad #${activityCount}</h3>
                    <button type="button" onclick="this.parentElement.parentElement.remove()" class="text-red-600 hover:text-red-800">‚ùå</button>
                </div>
                <div class="grid md:grid-cols-2 gap-3">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Zona</label>
                        <input type="text" name="actividad_zona[]" required class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="Ej: Nivel 4 - Estructura">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Actividad</label>
                        <input type="text" name="actividad_nombre[]" required class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="Ej: Vaciado de losa">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">% Avance Real</label>
                        <input type="number" name="actividad_avance[]" required min="0" max="100" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">% Programado</label>
                        <input type="number" name="actividad_programado[]" required min="0" max="100" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Observaciones</label>
                        <textarea name="actividad_obs[]" required class="w-full px-3 py-2 border border-gray-300 rounded-lg" rows="2"></textarea>
                    </div>
                </div>
            `;
            container.appendChild(activityDiv);
        }

        // Agregar incidente
        function addIncident() {
            incidentCount++;
            const container = document.getElementById('incidentContainer');
            const incidentDiv = document.createElement('div');
            incidentDiv.className = 'border-2 border-orange-200 rounded-lg p-4 bg-orange-50';
            incidentDiv.innerHTML = `
                <div class="flex justify-between items-center mb-3">
                    <h3 class="font-bold text-gray-800">Incidente #${incidentCount}</h3>
                    <button type="button" onclick="this.parentElement.parentElement.remove()" class="text-red-600 hover:text-red-800">‚ùå</button>
                </div>
                <div class="grid md:grid-cols-2 gap-3">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Tipo</label>
                        <select name="incidente_tipo[]" required class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                            <option value="">Seleccionar...</option>
                            <option value="Seguridad">Seguridad</option>
                            <option value="Calidad">Calidad</option>
                            <option value="Ambiental">Ambiental</option>
                            <option value="Operacional">Operacional</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Severidad</label>
                        <select name="incidente_severidad[]" required class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                            <option value="">Seleccionar...</option>
                            <option value="baja">üü¢ Baja</option>
                            <option value="media">üü° Media</option>
                            <option value="alta">üî¥ Alta</option>
                        </select>
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Descripci√≥n</label>
                        <textarea name="incidente_desc[]" required class="w-full px-3 py-2 border border-gray-300 rounded-lg" rows="2"></textarea>
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Acci√≥n Tomada</label>
                        <textarea name="incidente_accion[]" required class="w-full px-3 py-2 border border-gray-300 rounded-lg" rows="2"></textarea>
                    </div>
                </div>
            `;
            container.appendChild(incidentDiv);
        }

        // Preview de fotos
        function previewPhotos(event) {
            const preview = document.getElementById('photoPreview');
            preview.innerHTML = '';
            const files = Array.from(event.target.files).slice(0, 4);
            
            files.forEach(file => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const div = document.createElement('div');
                    div.className = 'relative';
                    div.innerHTML = `
                        <img src="${e.target.result}" class="photo-preview rounded-lg border-2 border-gray-300">
                        <div class="text-xs text-gray-600 mt-1 truncate">${file.name}</div>
                    `;
                    preview.appendChild(div);
                };
                reader.readAsDataURL(file);
            });
        }

        // Enviar formulario
        document.getElementById('inspectionForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Mostrar loading
            document.getElementById('loadingModal').classList.remove('hidden');
            
            // Preparar datos
            const formData = new FormData(e.target);
            const data = {};
            
            // Convertir FormData a objeto
            for (let [key, value] of formData.entries()) {
                if (key.includes('[]')) {
                    const cleanKey = key.replace('[]', '');
                    if (!data[cleanKey]) data[cleanKey] = [];
                    data[cleanKey].push(value);
                } else {
                    data[key] = value;
                }
            }
            
            // Agregar timestamp
            data.timestamp = new Date().toISOString();
            
            try {
                // Enviar a n8n
                const response = await fetch(WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    alert('‚úÖ ¬°Reporte generado exitosamente! Recibir√°s el PDF por correo en breve.');
                    e.target.reset();
                    document.getElementById('activityContainer').innerHTML = '';
                    document.getElementById('incidentContainer').innerHTML = '';
                    document.getElementById('photoPreview').innerHTML = '';
                    activityCount = 0;
                    incidentCount = 0;
                } else {
                    alert('‚ùå Error al generar el reporte. Por favor intenta nuevamente.');
                }
            } catch (error) {
                alert('‚ùå Error de conexi√≥n. Verifica tu conexi√≥n a internet.');
                console.error(error);
            } finally {
                document.getElementById('loadingModal').classList.add('hidden');
            }
        });

        // Agregar una actividad por defecto al cargar
        window.addEventListener('load', () => {
            addActivity();
        });
    </script>
</body>
</html>